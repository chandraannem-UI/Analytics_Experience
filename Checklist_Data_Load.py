# Databricks notebook source
# MAGIC %fs
# MAGIC ls 'mnt/edl/raw/na_pdc_powerfleet'

# COMMAND ----------

s='-------------------- ------------------------------ ----------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------- ----------------------- ----------------------- -------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- ------------ ------ ----------------------------------------------------------------------------------------------------------- --------------- ---------------------------------------------------------------------------------------------------- -------- ----------- ----------------------- ---------------------------------------------------------------------------------------------------- ----------------------------------------------------------------------------------------------------'

# COMMAND ----------

s_list= s.split()
print(s_list)

# COMMAND ----------

len_list=[]
tup_list=[]
l=0
for i in s_list:
  len_1=len(i)
  tup_1=(l,l+len(i))
  len_list.append(len_1)
  tup_list.append(tup_1)
  l=l+len(i)+1
print(len_list)
print(tup_list)
  
  

# COMMAND ----------

names = 'Row_ID               OSHA_ID                        ShiftID     ShiftName                                                                                                                                                                                                                                                        ShiftStart              ShiftEnd                DateCompleted           Partial              Vehicle                                                                                              VehExtID                                                                                             VehExtID2                                                                                            Make                                                                                                 Model                                                                                                VehicleType                                                                                          Operator                                                                                                                                                                                                                                                         LastName                                                                                             FirstName                                                                                            MI                                                                                                   OrgCode                                                                                              AccessID                                                                                             OprExtID                                                                                             OprClass                                                                                                                                                                                                 JobTitle                                                                                             OperatorGroup                                                                                        MeterReading Number Question                                                                                                    Response        Severity                                                                                             Sev_Code Issue       Last_Updated            Customer                                                                                             Site'

# COMMAND ----------

names_list=names.split()
print(names_list)

# COMMAND ----------

len(names_list)
len(len_list)

# COMMAND ----------

import pandas as pd
df = pd.read_fwf("/dbfs/mnt/edl/raw/na_pdc_powerfleet/APIChecklist_05302022.rpt",skipfooter=5,skiprows=2,colspecs=tup_list,names=names_list)

# COMMAND ----------

df.head()

# COMMAND ----------

df.tail()

# COMMAND ----------

sdf = spark.createDataFrame(df)

# COMMAND ----------

sdf.display()

# COMMAND ----------

sdf.write.parquet('/mnt/edl/raw/na_pdc_powerfleet/Checklist/', mode = 'overwrite')

# COMMAND ----------

# MAGIC %sql
# MAGIC CREATE DATABASE IF NOT EXISTS NA_PDC_POWERFLEET;

# COMMAND ----------

# MAGIC %sql
# MAGIC CREATE TABLE IF NOT EXISTS NA_PDC_POWERFLEET.Checklist
# MAGIC USING PARQUET
# MAGIC LOCATION '/mnt/edl/raw/na_pdc_powerfleet/Checklist/'
# MAGIC TBLPROPERTIES ("edl_sources"="com.deere.enterprise.datalake.raw.na_pdc_powerfleet")

# COMMAND ----------

# MAGIC %sql
# MAGIC REFRESH TABLE NA_PDC_POWERFLEET.Checklist

# COMMAND ----------

# MAGIC %sql
# MAGIC select count(*) from NA_PDC_POWERFLEET.Checklist

# Databricks notebook source
# MAGIC %fs
# MAGIC ls 'mnt/edl/raw/na_pdc_powerfleet'

# COMMAND ----------

s='--------------- ----------------------- ----------------------- ----------------- --------------------------------------- -------------------- -------------- ----------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------- ----------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------- --------------------------------------------------- ---------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------- --------------------------------------------------- --------------------------------------------------- ---------------------------------------------------------------------------------------------------- -------------------- ----------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------- --------------------------------------------------- --------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------- --------------------------------------------------- ---------------------------------------------------------------------------------------------------- --------------------------------------------------- --------------------------------------- ----------------------- ----------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- ---------------------------------------------------------------------------------------------------- ----------- --------------------------------------- ------------------ ------------- --------------------------------------- --------------------------------------- --------------------------------------- ----------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- ----------- ----------- ----------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- ----------- --------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- ---------------------------------------------------------------------------------------------------- ----------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- --------------------------------------- ----------------------- ---------------------------------------------------------------------------------------------------- ----------------------------------------------------------------------------------------------------'

# COMMAND ----------

s_list= s.split()
print(s_list)

# COMMAND ----------

len_list=[]
tup_list=[]
l=0
for i in s_list:
  len_1=len(i)
  tup_1=(l,l+len(i))
  len_list.append(len_1)
  tup_list.append(tup_1)
  l=l+len(i)+1
print(len_list)
print(tup_list)
  
  

# COMMAND ----------

len(len_list)

# COMMAND ----------

names = 'Sleeper_Mode_ID Sleep_Start             Sleep_End               Sleep_Thresh_Mins Sleep_Time_Mins                         Row_ID               Usage_Event_ID Shift_ID    Shift_Name                                                                                                                                                                                                                                                       Shift_Start             Shift_End               Operator_Group                                                                                                                                                                                           Operator_Group_Code                                                                                                                                                                                      Vehicle_Group                                                                                                                                                                                            Vehicle_Group_Code                                                                                                                                                                                       Operator_And_Vehicle_Group                                                                                                                                                                                                                                       Vehicle_ID  Vehicle                                             Make                                                                                                 Model                                                                                                Veh_Ext_ID                                          Veh_Ext_ID_2                                        Vehicle_Type                                                                                         Assigned             Employee_ID Operator                                                                                                                                                                   Last_Name                                           First_Name                                          MI                                                  Org_Code                                                                                                                                                                                                 Access_ID  Opr_Ext_ID                                          Opr_Class                                                                                            Job_Title                                           PowerUp_hrs                             Login                   Logoff                  Login_hrs                               Motion_hrs                              Idling_hrs                              Eng_Off_hrs                             Lift_hrs                                Pct_Motion                              Pct_Motion_2                            Pct_Idling                              Pct_Lift                                Pct_Lift_2                              Pct_Eng_Off                             End_Method                                                                                           End_Code    Batt_Vlt                                Batt_Level_Invalid Total_Impacts Cum_Eng_Starts                          Cumm_Lift                               Max_mph                                 T_ft        Odometer_miles                          Motion_2_hrs                            Lift_2_hrs                              GPU_Out_hrs                             Air_Out_hrs                             Auto_Level_hrs                          Canopy_hrs                              Plane_On_hrs                            Fuel_Level_Start                        Fuel_Level_End                          Output_Temp_Min                         Output_Temp_Max                         Max_lbs                                 Avg_lbs                                 TWL_ft      L_Count     LWL_Count   LWL_hrs                                 Odom_hrs                                Odom_w_Load_hrs                         Max_Lift_wo_Load_hrs                    Tow_Count   Dist_w_Tow_feet Total_Tow_hrs                           Max_Tow_wo_Load_hrs                     T_hrs                                   TWL_hrs                                 Pct_T                                   Pct_TWL                                 Sensor_Type                                                                                          Sensor_Code Key_On_Hrs                              Dead_Man_Hrs                            Load_Hdlr_Hrs                           Activity_Hrs                            Coast_Hrs                               Cum_Key_On                              Cum_Dead_Man                            Cum_Load_Hdlr                           Cum_Activity                            Cum_Coast                               Cum_GPU_Out_Hrs                         Cum_Air_Out_Hrs                         Cum_Auto_Level_Hrs                      Cum_Canopy_Hrs                          Cum_Plane_On_Hrs                        Last_Updated            Customer                                                                                             Site'

# COMMAND ----------

names_list=names.split()
print(names_list)

# COMMAND ----------

len(names_list)


# COMMAND ----------

import pandas as pd
df = pd.read_fwf("/dbfs/mnt/edl/raw/na_pdc_powerfleet/APISleeperDetail_05302022.rpt",skipfooter=5,skiprows=2,colspecs=tup_list,names=names_list)

# COMMAND ----------

df.head()

# COMMAND ----------

df.tail()

# COMMAND ----------

sdf = spark.createDataFrame(df)

# COMMAND ----------

sdf.display()

# COMMAND ----------

sdf.write.parquet('/mnt/edl/raw/na_pdc_powerfleet/Sleeper/', mode = 'overwrite')

# COMMAND ----------

# MAGIC %sql
# MAGIC CREATE DATABASE IF NOT EXISTS NA_PDC_POWERFLEET;

# COMMAND ----------

# MAGIC %sql
# MAGIC CREATE TABLE IF NOT EXISTS NA_PDC_POWERFLEET.Sleeper
# MAGIC USING PARQUET
# MAGIC LOCATION '/mnt/edl/raw/na_pdc_powerfleet/Sleeper/'
# MAGIC TBLPROPERTIES ("edl_sources"="com.deere.enterprise.datalake.raw.na_pdc_powerfleet")

# COMMAND ----------

# MAGIC %sql
# MAGIC REFRESH TABLE NA_PDC_POWERFLEET.Sleeper

# COMMAND ----------

# MAGIC %sql
# MAGIC select count(*) from NA_PDC_POWERFLEET.Sleeper
